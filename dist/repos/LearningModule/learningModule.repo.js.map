{"version":3,"file":"learningModule.repo.js","sources":["repos/LearningModule/learningModule.repo.ts"],"sourceRoot":"/","sourcesContent":["\r\n\r\nimport { LearningModule, ILearningModule  } from \"@src/models/LearningModule\";\r\nimport { IUpdateLearningModuleDTO } from \"@src/DTOs/learningModule/learningModule.dto\";\r\nimport logger from \"@src/system/logger/logger\";\r\n\r\nexport default class LearningModuleRepo\r\n{\r\n\r\n    constructor()\r\n    {\r\n\r\n    }\r\n\r\n    async create( learningModuleDoc: Pick< ILearningModule, 'title' | 'area' | 'stage' | 'description' | 'imgSrc' | 'isDraft' >  ): Promise< { learningModuleId: string, title: string, stage: string } | false > \r\n    {\r\n        try \r\n        {\r\n            const  learningModule: ILearningModule = await LearningModule.create( learningModuleDoc )\r\n\r\n            return { learningModuleId: learningModule._id as string , title: learningModule.title, stage: learningModule.stage as unknown as string  } \r\n        }\r\n        catch(e: any)\r\n        {\r\n            logger.error(e,\"RepoError: Create Learning Module\")\r\n            return false \r\n        }\r\n    }  \r\n\r\n    async get( moduleId: string ):Promise<    Pick<ILearningModule,'title' | 'description' | 'area' | 'stage' | 'imgSrc'> | boolean  > \r\n    {\r\n        try \r\n        {\r\n            const learningModule = await LearningModule.findById( moduleId ).select('title description area stage imgSrc').lean() \r\n\r\n            if( !learningModule )\r\n            {\r\n                return false \r\n            }\r\n\r\n            return learningModule \r\n        }\r\n        catch(e: any)\r\n        {\r\n            logger.error(e,`REPO ERROR: COULD NOT GET MODULE WITH ID ${ moduleId }`)\r\n            return false \r\n        }\r\n    }\r\n\r\n    async update( moduleID: string, moduleFields: IUpdateLearningModuleDTO ): Promise<number> \r\n    {\r\n            const { modifiedCount} = await LearningModule.updateOne({ _id: moduleID }, moduleFields, { rawResult: true })\r\n\r\n            logger.info(`Repo: Module Modified: ${ modifiedCount } `)\r\n            return modifiedCount \r\n    }\r\n\r\n    async delete( _id: string ): Promise<number> \r\n    {\r\n        const { deletedCount } = await LearningModule.deleteOne({ _id }).lean() \r\n        return deletedCount\r\n    }\r\n\r\n\r\n    async getUserLearningOverview( userId: string, learningModuleId: string, currentPartIndex: number )\r\n    {\r\n        const userLearningOverview = await LearningModule.findOne({ _id: userId, \"learningProfile._id\": learningModuleId },{  \"learningProfile.$\": 1}) \r\n\r\n        console.log(' ----Here ---')\r\n        console.dir( userLearningOverview ) \r\n    }\r\n       \r\n\r\n    async getNextPart( moduleId: string, nextPartIndex: number )\r\n    {\r\n\r\n        logger.info('Getting Learning Module Next Part')\r\n        const result= await LearningModule.findById(moduleId).select('parts').lean() \r\n\r\n        if( !result ) return null \r\n    \r\n        const { parts } = result \r\n        \r\n        console.log('-----')\r\n        console.dir( parts )\r\n\r\n        if( parts ) {\r\n            \r\n            if( !parts[nextPartIndex] )\r\n            {\r\n                logger.info(` Part: ${ nextPartIndex } does not exist on Module: ${ moduleId } `)\r\n                return null \r\n            }\r\n            \r\n            return parts[nextPartIndex] \r\n        \r\n        }\r\n        return null \r\n    }\r\n\r\n    async incrementNumberOfParts( moduleId: string )\r\n    {\r\n        await LearningModule.updateOne({ _id: moduleId },{ $inc: { totalParts: 1 }})\r\n    }\r\n\r\n    async decrementNumberOfParts( moduleId: string )\r\n    {\r\n        await LearningModule.updateOne({ _id: moduleId },{ $inc: { totalParts: -1 }})\r\n    }\r\n\r\n    async getLearningModulesUnderStage(\r\n        stageId: string,\r\n        page: number,\r\n        limit: number\r\n      ): Promise<   Pick<   ILearningModule, '_id' | 'title' | 'area' | 'description' |'stage' | 'imgSrc' | 'totalParts' >[] | null> {\r\n\r\n        // Define the fields to be selected in the query\r\n        const fields = '_id title area description imgSrc stage totalParts';\r\n      \r\n        // Calculate the number of documents to skip based on the current page\r\n        var skip = (page - 1) * limit;\r\n\r\n        // Fetch the learning modules with the specified stage ID\r\n        const learningModules = await LearningModule.find({ stage: stageId })\r\n          .select(fields)\r\n          .skip(skip)\r\n          .limit(limit);\r\n      \r\n            // Return null if no learning modules are found\r\n            if (learningModules.length === 0) return null \r\n      \r\n            // Return the found learning modules\r\n            return learningModules;\r\n      }\r\n      \r\n} "],"names":[],"mappings":"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","debug_id":"f0bf1fbc-fd9d-5cba-96e6-c0d4982b0088"}