{"version":3,"file":"tokens.js","sources":["util/Auth/tokens.ts"],"sourceRoot":"/","sourcesContent":["\r\nimport jwt, { JsonWebTokenError, SignOptions } from \"jsonwebtoken\" \r\nimport dotenv from \"dotenv\"\r\nimport config from \"config\"\r\nimport logger from \"@src/system/logger/logger\"\r\nimport { Request, Response, NextFunction } from \"express-serve-static-core\"\r\nimport { ServerError } from \"../Errors/Endpoints/serverError\"\r\nimport { IUserRequest } from \"types\"\r\nimport { UnauthorizedError } from \"../Errors/Endpoints/unauthorizedError\"\r\ndotenv.config() \r\n\r\n\r\nexport function generateJwtToken( user: object ): string | boolean\r\n{\r\n    try \r\n    {\r\n        const secretKey = process.env.JWT_SECRET \r\n        const options: SignOptions = config.get(\"jwt.options\")\r\n    \r\n        if( !secretKey )\r\n        {\r\n            logger.error('JWT SECRET KEY UNDEFINED')\r\n            return false\r\n        }\r\n    \r\n        const token = jwt.sign( user, secretKey, options )\r\n        return token \r\n    }\r\n    catch(e: any)\r\n    {\r\n        logger.error(e,\"JWT_SIGNING_ERROR\")\r\n\r\n        throw new ServerError(\"Server Encountered Error While Signing User \")\r\n    }\r\n}\r\n\r\n\r\nexport function validateRequestToken(req: Request, res: Response, next: NextFunction)\r\n{\r\n    try \r\n    {\r\n        const token = req.headers.authorization?.split(' ')[1];\r\n\r\n        if (!token) {\r\n          return res.status(401).json({ message: 'Access denied. No token provided.' });\r\n        }\r\n\r\n          // Decode and verify the token\r\n          const decoded = jwt.verify(token, process.env.JWT_SECRET as string) as IUserRequest \r\n\r\n          // Attach the decoded user data to the request object\r\n          req.user = decoded\r\n\r\n          if( !req.user._id ) return res.status(500).json({ success: false, msg:\"server error\"})\r\n         \r\n         next();\r\n    }\r\n    catch(e: any )\r\n    {\r\n        logger.error(e,`Error Occured while validating Request Token `)\r\n\r\n        if( e instanceof JsonWebTokenError ) return res.status(401).json({ success: false, msg: e.message })\r\n           \r\n        return res.status(500).json({ success: false, msg:\"Server Error\"})\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,4CAsBC;AAGD,oDA4BC;AAhED,6DAAkE;AAClE,oDAA2B;AAC3B,oDAA2B;AAC3B,uEAA8C;AAE9C,iEAA6D;AAG7D,gBAAM,CAAC,MAAM,EAAE,CAAA;AAGf,SAAgB,gBAAgB,CAAE,IAAY;IAE1C,IACA,CAAC;QACG,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,CAAA;QACxC,MAAM,OAAO,GAAgB,gBAAM,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;QAEtD,IAAI,CAAC,SAAS,EACd,CAAC;YACG,gBAAM,CAAC,KAAK,CAAC,0BAA0B,CAAC,CAAA;YACxC,OAAO,KAAK,CAAA;QAChB,CAAC;QAED,MAAM,KAAK,GAAG,sBAAG,CAAC,IAAI,CAAE,IAAI,EAAE,SAAS,EAAE,OAAO,CAAE,CAAA;QAClD,OAAO,KAAK,CAAA;IAChB,CAAC;IACD,OAAM,CAAM,EACZ,CAAC;QACG,gBAAM,CAAC,KAAK,CAAC,CAAC,EAAC,mBAAmB,CAAC,CAAA;QAEnC,MAAM,IAAI,yBAAW,CAAC,8CAA8C,CAAC,CAAA;IACzE,CAAC;AACL,CAAC;AAGD,SAAgB,oBAAoB,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;;IAEhF,IACA,CAAC;QACG,MAAM,KAAK,GAAG,MAAA,GAAG,CAAC,OAAO,CAAC,aAAa,0CAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;QAEvD,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,mCAAmC,EAAE,CAAC,CAAC;QAChF,CAAC;QAGC,MAAM,OAAO,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,UAAoB,CAAiB,CAAA;QAGnF,GAAG,CAAC,IAAI,GAAG,OAAO,CAAA;QAElB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG;YAAG,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,EAAC,cAAc,EAAC,CAAC,CAAA;QAEvF,IAAI,EAAE,CAAC;IACZ,CAAC;IACD,OAAM,CAAM,EACZ,CAAC;QACG,gBAAM,CAAC,KAAK,CAAC,CAAC,EAAC,+CAA+C,CAAC,CAAA;QAE/D,IAAI,CAAC,YAAY,gCAAiB;YAAG,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAA;QAEpG,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,EAAC,cAAc,EAAC,CAAC,CAAA;IACtE,CAAC;AACL,CAAC","debug_id":"3751ae86-ec25-5a4c-b5b7-60771ecc1160"}