{"version":3,"file":"generateJobRole.js","sources":["util/jobRoleGenerator/generateJobRole.ts"],"sourceRoot":"/","sourcesContent":["\r\nimport { config } from \"dotenv\"\r\nconfig() \r\n\r\n/*****************THE DIRTY FILE *********************************************** */\r\nimport fs from \"fs/promises\"\r\nimport path from \"path\" \r\nimport pdfParse from \"pdf-parse\"\r\nimport mammoth from \"mammoth\" \r\nimport logger from \"@src/system/logger/logger\"\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\"\r\nimport JobProfile from \"@src/models/JobProfile\"\r\n\r\n\r\nexport async function generateJobRoleFromResume( userId: string, jobRole: string, experienceLevel: string, resumePath: string )\r\n{\r\n    try \r\n    {\r\n        const resumeTextContent = await extractTextContentFromDocument(resumePath)\r\n\r\n        logger.debug(`JOB_ROLE_GENERATOR: Extracted Text From user: ${ userId }'s Resume`)\r\n        logger.info( resumeTextContent ) \r\n\r\n        await deleteResumeFromServer( resumePath ) \r\n\r\n        const generatedJobRole = await generateJobRoleWithAI( jobRole, experienceLevel, resumeTextContent)\r\n\r\n        await saveGeneratedJobRoleToDB( userId, generatedJobRole )\r\n\r\n    }\r\n    catch(e: any)\r\n    {\r\n        logger.error(e,`ROLE_GENERATOR_ERROR: Could Not Generate Job Role`)\r\n    }\r\n}\r\n\r\nasync function extractTextContentFromDocument( filePath: string  )\r\n{\r\n    try \r\n    {\r\n\r\n        // Extract File Extension \r\n        const fileExtension = path.extname(filePath).toLowerCase();\r\n\r\n        // Read the file buffer\r\n        const fileBuffer = await fs.readFile(filePath)\r\n\r\n\r\n        switch (fileExtension) {\r\n            case '.pdf':\r\n              // Extract text from PDF file\r\n              const pdfData = await pdfParse(fileBuffer);\r\n\r\n              logger.debug(`Text_From_Document_Extractor: Extracted text From PDF file `)\r\n              return pdfData.text;\r\n      \r\n            case '.docx':\r\n              // Extract text from DOCX file\r\n              const docxData = await mammoth.extractRawText({ buffer: fileBuffer });\r\n              logger.debug(`Text_From_Document_Extractor: Extracted text From DOCX file `)\r\n              return docxData.value;\r\n      \r\n            case '.txt':\r\n              // Extract text from TXT file\r\n              logger.debug(`Text_From_Document_Extractor: Extracted text From TEXT file `)\r\n              return fileBuffer.toString('utf-8');\r\n      \r\n            default:\r\n              throw new Error('Unsupported file type') \r\n        }\r\n    }\r\n    catch(e: any) \r\n    {\r\n        logger.error(e,`Text_From_Document_Extractor: ERROR`)\r\n        throw e \r\n    }\r\n}\r\n\r\nasync function deleteResumeFromServer( filePath: string )\r\n{\r\n  // Delete the file after successful extraction\r\n  await fs.unlink(filePath);\r\n  logger.debug(`File ${filePath} deleted successfully.`);\r\n}\r\n\r\n\r\nasync function generateJobRoleWithAI( jobRole: string, experienceLevel: string, resume: string )\r\n{\r\n\r\n\r\n  const JOB_ROLE_GENERATION_PROMPT = `\r\n  \r\n\r\nYour_Instructions: You are an AI system that specializes in creating job descriptions matching exactly how real world job descriptions would look like on platforms like. You will take three inputs.\r\n\r\nInput number one: \r\nThe user's job role. You will use the job role to determine the job for which you will generate the description. \r\n\r\nTwo is the experience level:\r\nYou will use the experience level to make the job description align with the relevant seniority specified. \r\n\r\nThree is the user's resume:\r\nYou will examine the resume and extract the skills which the user uses to perform the role, and make sure the job description you will generate contains those skills. Here's an analogy to make this instruction clearer,if the user is a \r\nbackend developer that uses python , don't create a job description that the roles needs C#, when the user clearly does \r\nnot have C# skills. So thats the idea.\r\nNote: Do not include any of your ai assistant responses. Just come up with a fictional company and generate the job role with the rules and fill any place holder with fictional data, e.g [yourcompanyname].\r\nSo Let's Go!\r\n\r\nRole: ${ jobRole }\r\nexperienceLevel: ${ experienceLevel }\r\nresume: ${ resume }\r\n  `     \r\n\r\n\r\n    const GEMINI_API_KEY = process.env.GEMINI_API_KEY || '' \r\n    const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);\r\n\r\n    async function run() \r\n    {\r\n                const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\"});\r\n                const result = await model.generateContent( JOB_ROLE_GENERATION_PROMPT  );\r\n                console.log(result.response.text());\r\n                return result.response.text() \r\n    }\r\n\r\n    const result = run() \r\n     return result \r\n\r\n}\r\n\r\n\r\nasync function saveGeneratedJobRoleToDB( userId: string, generatedJobRole: string )\r\n{\r\n  try \r\n  { \r\n\r\n      await JobProfile.updateOne\r\n      (\r\n        { userId },\r\n        { $push: { generatedJobRoles: { roleContent: generatedJobRole }  }  }\r\n      )\r\n\r\n\r\n      logger.debug(`Generated Job Description Saved to user job profile`)\r\n  } \r\n  catch(e: any)\r\n  {\r\n      logger.error(e,`Error Occured while saving Generated Job Descrition to database `)\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debug_id":"005437fd-8faf-5ee3-bd67-f0dcc14e46aa"}